{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEC Tool | Chatbox</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.0/mdb.min.css" rel="stylesheet" />
    <!-- custom css -->
    <link rel="stylesheet" href="{% static 'style/common.css' %}">
    {% comment %} jquery {% endcomment %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
</head>

<body class="expert">

    <div class="container text-center">
        <div class="position-relative back-buttons">
            <a href="{% url 'expert_review' %}">
                <button class="position-absolute top-0 start-0 btn btn-small btn-primary bg-primary-darker shadow-1"><i
                    class="fas fa-arrow-left"></i> &nbsp; expert review page</button>
            </a>
        </div>
        <h3 class="m-5 fw-bold main-heading">CHAT BOX</h3>

        <div class="m-5 row">

            <div class="card bg-pastel-maroon col-3 shadow-5">
                <small class="text-start p-3">

                    {% comment %} <div class="room_list">
                        {% for room in rooms %}
                        <a href="{% url 'room' room_name=room %}"><i class="fas fa-comments"></i> &nbsp; {{room}}</a><hr class="text-white">
                        {% endfor %}
                    </div> {% endcomment %}

                    <table class="table table-sm w-100 room_list">
                        <tbody>
                            {% if not rooms %}
                            <div class="text-white">You have no chats</div>
                            {% endif %}
                            {% for room in rooms %}
                            <tr>
                                <th scope="row"><a href="{% url 'room' room_name=room %}"><i class="fas fa-comments"></i> &nbsp; {{room}}</a></th>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </small>
            </div>

            <div class="col-1"></div>
            
            <div class="card bg-pastel-maroon col-8 shadow-5">
                {% if convo == False %}

                <div class="no-convo m-3 p-5">
                    <i class="text-light fas fa-comments fa-8x mb-4"></i><br>
                    <small class='text-light'>Select a conversation</small>
                </div>
                
                {% else %}
                
                <div class="chat-user-name text-center fs-5">
                    <i class="fas fa-users"></i>&nbsp; {{room_name}}</div>
                
                <small class="text-start p-2 pb-4 parent">
                    <div id="chatbox">
                        {% for msg in messages %}
                        {% if msg.sender != request.user.username %}
                        <p class="msg-recieved">{{msg.message}}</p>
                        {% else %}
                        <p class="msg-send">{{msg.message}}</p>
                        {% endif %}                                
                        {% endfor %}
                    </div>
                    <form id='message_form' action="" method="post">
                        {% csrf_token %}
                        <div class="form-outline">
                            <textarea 
                                id='message' name='message' 
                                class="text-black form-control" rows="4"></textarea>
                            <label for='message' class="form-label">Message</label>
                        </div>
                        <button type="submit"
                            class="btn btn-primary bg-primary-darker-2 shadow-0 btn-block">send</button>
                    </form>                            
                </small>
                {% endif %}               

                
            </div>
            
        </div>

    </div>

    



    <footer>
        <div class="text-end p-5 mt-5 pb-1">
            <img src="{% static 'assets/images/logo.png' %}" height="24" alt="gec.dL Logo" loading="lazy" />

            <p class="text-primary-darker">Powered by deep learning algorithms just for you!</p>
        </div>
        <div class="bg-primary-darker p-3 text-light text-center">Â© 2022 Grammar Error Correction (GEC) Software</div>
    </footer>

    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.0/mdb.min.js"></script>
    <script src="{% static 'js/chat.js' %}"></script>
</body>

</html>